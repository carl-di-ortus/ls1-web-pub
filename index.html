<!DOCTYPE html>
<html>
<head>
    <link href="css/bootstrap.css" rel="stylesheet" type="text/css" />

    <title>Tabbed nav-bar menu with dummy page contents</title>
    
    <style type="text/css" media="screen">
        canvas, img { display:block; margin:1em auto; border:1px solid black; }
        canvas { background:url(img/earth_800.png) }
    </style>
</head>
<body>
    
<h2><a href="./index.html">LSat1-web-pub</a></h2>

<!-- ==== Nav-bar tabbed menu ==== -->
<ul class="nav nav-tabs">
    <li class="dropdown active">
        <a class="dropdown-toggle" data-toggle="dropdown" href="#">Telemetry<b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li class="active"><a href="#Telemetry" data-toggle="tab">Newest</a></li>
            <li><a href="#Archive" data-toggle="tab">Archive</a></li>
            <li class="divider" />
            <li><a href="#Submit" data-toggle="tab">Submit telemetry data</a></li>
            <li><a href="#Amateur" data-toggle="tab">Amateur data archive</a></li>
        </ul>
    </li>
    <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown" href="#">GPS<b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="#GPS" data-toggle="tab">Map</a></li>
            <li><a href="#History" data-toggle="tab">History</a></li>
        </ul>
    </li>
    <li><a data-toggle="tab" href="#Photo">Photo</a></li>
</ul>

<!-- ==== Content ==== -->
<div class="tab-content">
    
    <!-- ==== Newest telemetry ==== -->
    <div id="Telemetry" class="tab-pane fade active in">
        <h3>Telemetry data</h3>
        <div>   
            <div id="chart_div" style="width: 500px; height: 500px;"></div>
            <p>[Dummy other text]</p>
        </div>
    </div>
    
    <!-- ==== Telemetry archive ==== -->
    <div id="Archive" class="tab-pane fade">
        <h3>Telemetry archive</h3>
        <div>
            <p>todo: insert table here</p>
            <span id="TArchive"></span>
            <!--
            <script type="text/javascript" language="javascript">
                var the_object = {}; 
                var http_request = new XMLHttpRequest();
                http_request.open( "GET", "http://127.0.0.1:12321/ls1mcs/api/telemetry/5646", true );
                
                http_request.onreadystatechange = function () {
                    if ( http_request.readyState == 4 && http_request.status == 200 ) {
                        the_object = JSON.parse( http_request.responseText );
                        document.getElementById("TArchive").innerHTML=the_object.field1+" "+the_object.field2
                    } else {
                        document.getElementById("TArchive").innerHTML="Error: Could not get data"
                    }
                };
                http_request.send(null);
            </script>
            -->
        </div>
    </div>
    
    <!-- ==== Amateur submit page ==== -->
    <div id="Submit" class="tab-pane fade">
        <h3>Submit data</h3>
        <div>
            <p>todo: insert submition fields here</p>
        </div>
    </div>
    
    <!-- ==== Amateur archive ==== -->
    <div id="Amateur" class="tab-pane fade">
        <h3>Amateur radio archive</h3>
        <div>
            <p>todo: insert amateur archive table here</p>
        </div>
    </div>
    
    <!-- ==== GPS map ==== -->
    <div id="GPS" class="tab-pane fade">
        <h3>GPS data</h3>
        <canvas id="MapCanvas" width="800" height="400">
            If you see this - your browser does not support HTML5 Canvas.
        </canvas>
        <div id="Coord">   </div>
        <script type="text/javascript" language="javascript">
            function getData() {
                setTimeout(function () {
                    var http_request = new XMLHttpRequest();
                    http_request.open( "GET","http://127.0.0.1:12321/ls1mcs/api/sat/LS1/position/predicted/current", true );
                    
                    http_request.onreadystatechange = function () {
                        if ( http_request.readyState == 4 && http_request.status == 200 ) {
                            var position = JSON.parse( http_request.responseText );
                            draw(position);
                        } else {
                            document.getElementById("Coord").innerHTML+="Error: Could not get data"
                        }
                    };
                    http_request.send(null);
                    getData();
                }, 1000)
            }
            
            getData();
            function draw(data) {
                var time = data.timestamp;
                var lon = data.longitude;
                var lat = data.latitude;
                var alt = data.altitude;
                putFootprint(lon, lat, alt);
                putDot(lon, lat);
                document.getElementById("Coord").innerHTML="Timestamp: "+time+"<br/>Longitude: "+lon+"<br/>Latitude: "+lat+"<br/>Altitude: "+alt
            }
            function putDot(lon, lat) {
                var x = lon*400/180+400;
                var y = lat*200/90+200;
                var spot = document.getElementById("MapCanvas");
                var context = spot.getContext('2d');
//                context.clearRect(0, 0, spot.width, spot.height);
                context.fillStyle = 'red';
                context.fillRect(x, y, 3, 3);
            }
            function putFootprint(lon, lat, alt) {
                var x = lon*400/180+400;
                var y = lat*200/90+200;
                var a = alt
                var foot_radius = Math.acos(6371/(6371+a))*6371;
                var draw_radius = (foot_radius/20000)*400;
                var spot = document.getElementById("MapCanvas");
                var context = spot.getContext('2d');
                context.clearRect(0, 0, spot.width, spot.height);
                context.beginPath();
                context.arc(x, y, draw_radius, 0, 2 * Math.PI, true);
                context.strokeStyle = 'yellow';
                context.stroke();
            }
        </script>
    </div>
    
    <!-- ==== GPS history table ==== -->
    <div id="History" class="tab-pane fade">
        <h3>GPS history</h3>
        <div>
            <p>todo: insert table here</p>
        </div>
    </div>
    
    <!-- ==== Photo table ==== -->
    <div id="Photo" class="tab-pane fade">
        <h3>Photo data</h3>
        <div>
            <p>Photo table</p>
            <p>Photo Location </p>
            <p>Map Photo</p>
        </div>
    </div>
</div>

<!-- ==== Loading JS (they say it's faster here, than in <head> tag) ==== -->
<script src="js/jquery-1.9.1.js"></script>
<script src="js/bootstrap.js"></script>
<script src="https://www.google.com/jsapi"></script>
<script src="js/content.js"></script>

</body>
</html>
